# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ò—Å—Ç–æ—Ä–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º!

## –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### –ü—Ä–æ–±–ª–µ–º–∞
–¢–µ—Å—Ç–µ—Ä —Ä–∞–±–æ—Ç–∞–ª (—Å–æ—Ö—Ä–∞–Ω—è–ª –≤ –±–∞–∑—É), –Ω–æ —Ä–µ–∞–ª—å–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –≤–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–ª–æ—Å—å.

### –ü—Ä–∏—á–∏–Ω–∞
`edit-mode-script.js` (–∫–æ—Ç–æ—Ä—ã–π –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–ª–∏–∫–∏ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–∞—Ö) –Ω–µ –±—ã–ª –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å —Å–∏—Å—Ç–µ–º–æ–π –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–∞–≤–æ–∫.

### –†–µ—à–µ–Ω–∏–µ
–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä—è–º–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `edit-mode-script.js`:

1. ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `checkEditorAuth()`**
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –∏–∑ localStorage
   
2. ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `saveEditToHistory()`**
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—Ä–∞–≤–∫—É –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
   - –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ editId
   - –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–ø—Ä—è–º—É—é —Å Supabase

3. ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ `showPopup()`**
   - –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ª–æ–≥–∏–Ω, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

4. ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ `saveEditToHistory()` –≤ `handlePopupSave()`**
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å—Ç–∞—Ä—ã–π —Ç–µ–∫—Å—Ç –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–æ–≤—ã–π —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
   - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–µ–ø–µ—Ä—å

### 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–π —ç–ª–µ–º–µ–Ω—Ç
```javascript
// –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
const editor = checkEditorAuth();
if (!editor) {
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
  alert('Please login first');
  return;
}
```

### 2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç –∏ –Ω–∞–∂–∏–º–∞–µ—Ç Save
```javascript
// –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Å—Ç–∞—Ä—ã–π —Ç–µ–∫—Å—Ç
const oldText = currentEditingInfo.targetElement?.textContent || '';

// –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∏–∑–º–µ–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ API
const response = await fetch('/api/apply-edit', {...});

// –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –∏—Å—Ç–æ—Ä–∏—é
await saveEditToHistory(editId, oldText, newText, result.editData);
```

### 3. –ó–∞–ø–∏—Å—å –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
```sql
INSERT INTO edit_history (
  editor_id,
  editor_email,
  editor_name,
  edit_type,
  target_type,
  target_id,
  file_path,
  content_before,
  content_after,
  metadata
)
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### ‚úÖ –¢–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**
2. **–ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å** (Settings ‚Üí Edit History ‚Üí Login)
3. **–í–∫–ª—é—á–∏—Ç–µ —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è** (–µ—Å–ª–∏ –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞)
4. **–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –ª—é–±–æ–π —Ç–µ–∫—Å—Ç**
5. **–ò–∑–º–µ–Ω–∏—Ç–µ —Ç–µ–∫—Å—Ç**
6. **–ù–∞–∂–º–∏—Ç–µ Save**
7. **–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å (F12)**

### –õ–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏:
```
[INLINE EDITOR] Saving edit to history: {...}
[INLINE EDITOR] Edit saved to history successfully: {...}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±–∞–∑–µ:
```sql
SELECT * FROM edit_history ORDER BY created_at DESC LIMIT 1;
```

–î–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å —Å –≤–∞—à–µ–π –ø—Ä–∞–≤–∫–æ–π!

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ UI:
- Settings ‚Üí Edit History - —É–≤–∏–¥–∏—Ç–µ —Å–≤–æ—é –ø—Ä–∞–≤–∫—É
- `/edit` - —É–≤–∏–¥–∏—Ç–µ –≤—Å–µ –ø—Ä–∞–≤–∫–∏

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –≤ –∫–æ–¥–µ

### –§–∞–π–ª: `plugins/visual-editor/edit-mode-script.js`

**–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞:**
```javascript
// Helper function to check editor authentication
function checkEditorAuth() {
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ localStorage
}

// Function to save edit to history
async function saveEditToHistory(editId, contentBefore, contentAfter, editData) {
  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Supabase
}
```

**–ò–∑–º–µ–Ω–µ–Ω–æ –≤ `showPopup()`:**
```javascript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
const editor = checkEditorAuth();
if (!editor) {
  alert('Please login');
  return;
}
```

**–ò–∑–º–µ–Ω–µ–Ω–æ –≤ `handlePopupSave()`:**
```javascript
// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
const oldText = currentEditingInfo.targetElement?.textContent || '';

// –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
if (result.success) {
  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é
  await saveEditToHistory(editId, oldText, newText, result.editData);
}
```

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. –£–±—Ä–∞–Ω –∑–∞–ø—Ä–æ—Å –ø—Ä–∏—á–∏–Ω—ã –æ—Ç–∫–∞—Ç–∞
- –¢–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ Yes/No
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–∏—á–∏–Ω–∞: 'User rollback' –∏–ª–∏ null

### 2. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```javascript
console.log('[INLINE EDITOR] Saving edit to history:', historyRecord);
console.log('[INLINE EDITOR] Edit saved to history successfully:', data);
```

## –ü–æ–ª–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –ö–ª–∏–∫ –Ω–∞ —Ç–µ–∫—Å—Ç
         ‚Üì
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (checkEditorAuth)
         ‚Üì
3. –ü–æ–∫–∞–∑–∞—Ç—å popup —Å —Ç–µ–∫—É—â–∏–º —Ç–µ–∫—Å—Ç–æ–º
         ‚Üì
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç ‚Üí Save
         ‚Üì
5. –í—ã–∑–æ–≤ API /api/apply-edit
         ‚Üì
6. –§–∞–π–ª –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
         ‚Üì
7. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ edit_history (saveEditToHistory)
         ‚Üì
8. –ó–∞–ø–∏—Å—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö ‚úÖ
```

## –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

### ‚úÖ –ß–µ–∫–ª–∏—Å—Ç:
- [ ] –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç (localStorage —Å–æ–¥–µ—Ä–∂–∏—Ç editor_auth)
- [ ] –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Ç–µ–∫—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- [ ] –ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—è–≤–ª—è—é—Ç—Å—è –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏
- [ ] –ó–∞–ø–∏—Å—å –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ Supabase ‚Üí edit_history
- [ ] –ò—Å—Ç–æ—Ä–∏—è –≤–∏–¥–Ω–∞ –≤ Settings ‚Üí Edit History
- [ ] –ò—Å—Ç–æ—Ä–∏—è –≤–∏–¥–Ω–∞ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ /edit
- [ ] –û—Ç–∫–∞—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç (—Ç–æ–ª—å–∫–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ, –±–µ–∑ –ø—Ä–∏—á–∏–Ω—ã)

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:
```javascript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
JSON.parse(localStorage.getItem('editor_auth'))

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –ø—Ä–∞–≤–∫—É
const { supabase } = await import('/src/lib/supabaseClient.js');
const { data } = await supabase
  .from('edit_history')
  .select('*')
  .order('created_at', { ascending: false })
  .limit(1);
console.log(data);
```

### –í Supabase SQL Editor:
```sql
-- –í—Å–µ –ø—Ä–∞–≤–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –º–∏–Ω—É—Ç
SELECT * 
FROM edit_history 
WHERE created_at > NOW() - INTERVAL '5 minutes'
ORDER BY created_at DESC;

-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∞–≤–æ–∫ –ø–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞–º
SELECT 
  editor_name,
  COUNT(*) as edit_count
FROM edit_history
GROUP BY editor_name
ORDER BY edit_count DESC;
```

## üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç:
- ‚úÖ –†–µ–∞–ª—å–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
- ‚úÖ –¢–µ—Å—Ç–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ UI
- ‚úÖ –û—Ç–∫–∞—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ dev —Å–µ—Ä–≤–µ—Ä –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ! üöÄ
